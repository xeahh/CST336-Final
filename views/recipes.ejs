<!DOCTYPE html>
<html lang="en">
<head>

   

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <link href="css/recipes.css" rel="stylesheet">
     <%- include("partials/head.ejs") %> 
    <title>Recipes</title>
</head>
<body>
    

    <%- include("partials/nav.ejs") %>

    <h1 id="recipes"> Recipes</h1>

    <div id="mainContainer">
        <div id="favorites">
            <span id="favTitle">Favorites <img id="heart" src="/img/heart.png"></span>
            <div id="meals">
                <figure id="meal1">

                </figure>

                <figure id="meal2">

                </figure>

                <figure id="meal1">
                    
                </figure>
            </div>
        </div>

        <div id="allRecipes">
            <button type="button" data-toggle="modal" data-target="#exampleModal" id="add">+ Add Recipe</button>
            <div id="recipeBox">
                <% for(let row of rows){%>
                  <button type="button"  class="mealLink" data-toggle="modal" data-target="#exampleModalLong" href="#" mealId="<%= row.name%>">
                    <%= row.name %>
                  </button>
                <%}%>
            </div>
        </div>
        

    </div>

<!-- add recipe modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Recipe Entry Form</h5>
         
        </button>
        </div>
        <div class="modal-body">
          <form>
            <div class="form-group">
              <label for="recipient-name" class="col-form-label">Recipe Name:</label>
              <input type="text" class="form-control" id="recipient-name">
            </div>
            <div class="form-group">
              <label for="message-text" class="col-form-label"> Seperate each ingredient with a comma (ex: Cilantro, Rice)
              </label><br>
             
              <textarea class="form-control" id="message-text"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Send message</button>
        </div>
      </div>
    </div>
  </div>
 <!-- individual meal modal -->
 <div class="modal fade" id="mealModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="mealName">Modal title</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <div id="authorInfo"> 
              <img id="thumbnail"><br>
              <h1 id="mealName"></h1><br>
              Instructions: <span id="instructions"></span><br>
             


          </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
  <script>
document.querySelectorAll(".mealLink").forEach((mealLink) => {
    mealLink.removeEventListener("click", displayMealInfo); // Prevent duplicate listeners
    mealLink.addEventListener("click", displayMealInfo);
});

async function displayMealInfo(event) {
    event.stopPropagation(); // Prevent event bubbling

    let mealId = this.getAttribute('mealId');
    console.log("Meal ID:", mealId); // Confirm mealId is retrieved correctly

    let url = "/recipe/meal/" + mealId;
    console.log("Fetching URL:", url); // Confirm the correct URL is being hit

    let response = await fetch(url);
    let data = await response.json();

    console.log("Fetched Data:", data); // Confirm the data structure from the backend

    document.querySelector("#mealName").innerText = data[0].name;
    document.querySelector("#thumbnail").src = data[0].thumbnail;
    document.querySelector("#instructions").innerText = data[0].instructions;

    const myModal = new bootstrap.Modal('#mealModal');
    myModal.show();
}   
  </script>


  
<!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.3/dist/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    -->
</body>
</html>